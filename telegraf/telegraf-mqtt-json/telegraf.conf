# Generated at 2025-10-05 04:20:31
# Telegraf Configuration for MQTT to InfluxDB with JSON Parsing
# Generated from CSV file

# ###############################################################################
# #                            AGENT SETTINGS                                   #
# ###############################################################################

[agent]
interval = "10s"
round_interval = true
metric_batch_size = 1000
metric_buffer_limit = 10000
collection_jitter = "0s"
flush_interval = "10s"
flush_jitter = "0s"
precision = ""
hostname = ""
omit_hostname = false

# ###############################################################################
# #                            INPUT PLUGINS                                    #
# ###############################################################################

# # Read and parse JSON data from MQTT topics

# # Configuration for PythonTestInputTemperatureControl topic

# # Configuration for PythonTestInputWaterTank topic

[[inputs.mqtt_consumer]]
servers = ["tcp://mosquitto:1883"]
topics = ["PythonTestInputTemperatureControl"]
data_format = "json_v2"

[[inputs.mqtt_consumer.json_v2]]
measurement_name = "mqtt"

[[inputs.mqtt_consumer.json_v2.field]]
path = "cooler.temperature"
rename = "PythonTestInputTemperatureControl/cooler/temperature"
type = "float"

[[inputs.mqtt_consumer.json_v2.field]]
path = "cooler.value2"
rename = "PythonTestInputTemperatureControl/cooler/value2"
type = "float"

[[inputs.mqtt_consumer.json_v2.field]]
path = "heater.temperature"
rename = "PythonTestInputTemperatureControl/heater/temperature"
type = "float"

[[inputs.mqtt_consumer.json_v2.field]]
path = "heater.value2"
rename = "PythonTestInputTemperatureControl/heater/value2"
type = "float"

[inputs.mqtt_consumer.tags]
MQTTInputName = "PythonTestInputTemperatureControl"

[[inputs.mqtt_consumer]]
servers = ["tcp://mosquitto:1883"]
topics = ["PythonTestInputWaterTank"]
data_format = "json_v2"

[[inputs.mqtt_consumer.json_v2]]
measurement_name = "mqtt"

[[inputs.mqtt_consumer.json_v2.field]]
path = "Volume"
rename = "PythonTestInputWaterTank/Volume"
type = "float"

[inputs.mqtt_consumer.tags]
MQTTInputName = "PythonTestInputWaterTank"

# ###############################################################################
# #                            OUTPUT PLUGINS                                   #
# ###############################################################################

# # --- InfluxDB v2 Output ---

[[outputs.influxdb_v2]] # Replace with your InfluxDB Org or env var
urls = ["http://influxdb:8086"]
token = "$DOCKER_INFLUXDB_INIT_ADMIN_TOKEN"
organization = "$DOCKER_INFLUXDB_INIT_ORG"
bucket = "jsontest"
