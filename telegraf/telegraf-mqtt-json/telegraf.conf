# Generated at 2025-10-05 11:11:42
# Telegraf Configuration for MQTT to InfluxDB with JSON Parsing
# Generated from CSV file

# ###############################################################################
# #                            AGENT SETTINGS                                   #
# ###############################################################################

[agent]
interval = "10s"
round_interval = true
metric_batch_size = 1000
metric_buffer_limit = 10000
collection_jitter = "0s"
flush_interval = "10s"
flush_jitter = "0s"
precision = ""
hostname = ""
omit_hostname = false

# ###############################################################################
# #                            INPUT PLUGINS                                    #
# ###############################################################################

# # Read and parse JSON data from MQTT topics

# # Configuration for factory/production/dailyProduction topic

# # Configuration for factory/financial/profitMargin topic

# # Configuration for factory/oee/performance topic

# # Configuration for factory/oee/quality topic

# # Configuration for factory/oee/oee topic

# # Configuration for factory/resources/workersInUse topic

# # Configuration for factory/resources/workerUtilization topic

# # Configuration for factory/equipment/cnc/1/temperature topic

# # Configuration for factory/financial/revenue topic

# # Configuration for factory/financial/profit topic

[[inputs.mqtt_consumer]]
servers = ["tcp://mosquitto:1883"]
topics = ["factory/production/dailyProduction"]
data_format = "json_v2"

[[inputs.mqtt_consumer.json_v2]]
measurement_name = "mqtt"

[[inputs.mqtt_consumer.json_v2.field]]
path = "value"
rename = "factory/production/dailyProduction"
type = "float"

[inputs.mqtt_consumer.tags]
MQTTInputName = "factory/production/dailyProduction"

[[inputs.mqtt_consumer]]
servers = ["tcp://mosquitto:1883"]
topics = ["factory/financial/profitMargin"]
data_format = "json_v2"

[[inputs.mqtt_consumer.json_v2]]
measurement_name = "mqtt"

[[inputs.mqtt_consumer.json_v2.field]]
path = "value"
rename = "factory/financial/profitMargin"
type = "float"

[inputs.mqtt_consumer.tags]
MQTTInputName = "factory/financial/profitMargin"

[[inputs.mqtt_consumer]]
servers = ["tcp://mosquitto:1883"]
topics = ["factory/oee/performance"]
data_format = "json_v2"

[[inputs.mqtt_consumer.json_v2]]
measurement_name = "mqtt"

[[inputs.mqtt_consumer.json_v2.field]]
path = "value"
rename = "factory/oee/performance"
type = "float"

[inputs.mqtt_consumer.tags]
MQTTInputName = "factory/oee/performance"

[[inputs.mqtt_consumer]]
servers = ["tcp://mosquitto:1883"]
topics = ["factory/oee/quality"]
data_format = "json_v2"

[[inputs.mqtt_consumer.json_v2]]
measurement_name = "mqtt"

[[inputs.mqtt_consumer.json_v2.field]]
path = "value"
rename = "factory/oee/quality"
type = "float"

[inputs.mqtt_consumer.tags]
MQTTInputName = "factory/oee/quality"

[[inputs.mqtt_consumer]]
servers = ["tcp://mosquitto:1883"]
topics = ["factory/oee/oee"]
data_format = "json_v2"

[[inputs.mqtt_consumer.json_v2]]
measurement_name = "mqtt"

[[inputs.mqtt_consumer.json_v2.field]]
path = "value"
rename = "factory/oee/oee"
type = "float"

[inputs.mqtt_consumer.tags]
MQTTInputName = "factory/oee/oee"

[[inputs.mqtt_consumer]]
servers = ["tcp://mosquitto:1883"]
topics = ["factory/resources/workersInUse"]
data_format = "json_v2"

[[inputs.mqtt_consumer.json_v2]]
measurement_name = "mqtt"

[[inputs.mqtt_consumer.json_v2.field]]
path = "value"
rename = "factory/resources/workersInUse"
type = "float"

[inputs.mqtt_consumer.tags]
MQTTInputName = "factory/resources/workersInUse"

[[inputs.mqtt_consumer]]
servers = ["tcp://mosquitto:1883"]
topics = ["factory/resources/workerUtilization"]
data_format = "json_v2"

[[inputs.mqtt_consumer.json_v2]]
measurement_name = "mqtt"

[[inputs.mqtt_consumer.json_v2.field]]
path = "value"
rename = "factory/resources/workerUtilization"
type = "float"

[inputs.mqtt_consumer.tags]
MQTTInputName = "factory/resources/workerUtilization"

[[inputs.mqtt_consumer]]
servers = ["tcp://mosquitto:1883"]
topics = ["factory/equipment/cnc/1/temperature"]
data_format = "json_v2"

[[inputs.mqtt_consumer.json_v2]]
measurement_name = "mqtt"

[[inputs.mqtt_consumer.json_v2.field]]
path = "value"
rename = "factory/equipment/cnc/1/temperature"
type = "float"

[inputs.mqtt_consumer.tags]
MQTTInputName = "factory/equipment/cnc/1/temperature"

[[inputs.mqtt_consumer]]
servers = ["tcp://mosquitto:1883"]
topics = ["factory/financial/revenue"]
data_format = "json_v2"

[[inputs.mqtt_consumer.json_v2]]
measurement_name = "mqtt"

[[inputs.mqtt_consumer.json_v2.field]]
path = "value"
rename = "factory/financial/revenue"
type = "float"

[inputs.mqtt_consumer.tags]
MQTTInputName = "factory/financial/revenue"

[[inputs.mqtt_consumer]]
servers = ["tcp://mosquitto:1883"]
topics = ["factory/financial/profit"]
data_format = "json_v2"

[[inputs.mqtt_consumer.json_v2]]
measurement_name = "mqtt"

[[inputs.mqtt_consumer.json_v2.field]]
path = "value"
rename = "factory/financial/profit"
type = "float"

[inputs.mqtt_consumer.tags]
MQTTInputName = "factory/financial/profit"

# ###############################################################################
# #                            OUTPUT PLUGINS                                   #
# ###############################################################################

# # --- InfluxDB v2 Output ---

[[outputs.influxdb_v2]] # Replace with your InfluxDB Org or env var
urls = ["http://influxdb:8086"]
token = "$DOCKER_INFLUXDB_INIT_ADMIN_TOKEN"
organization = "$DOCKER_INFLUXDB_INIT_ORG"
bucket = "jsontest"
